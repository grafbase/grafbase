{{- if .Values.doppler.enabled }}
apiVersion: secrets.doppler.com/v1alpha1
kind: DopplerSecret
metadata:
  name: {{ .Values.doppler.secretName | default (include "app.fullname" .) }}
  namespace: {{ .Values.doppler.namespace | default "doppler-operator-system" }}
  labels:
    {{- include "app.labels" . | nindent 4 }}
  annotations:
    "helm.sh/resource-policy": keep
spec:
  tokenSecret:
    name: {{ .Values.doppler.tokenSecretName | default "doppler-token-secret" }}
    namespace: {{ .Values.doppler.namespace | default "doppler-operator-system" }}
  project: {{ required "doppler.project is required when doppler.enabled is true" .Values.doppler.project }}
  config: {{ required "doppler.config is required when doppler.enabled is true" .Values.doppler.config }}
  managedSecret:
    name: {{ .Values.doppler.secretName | default (include "app.fullname" .) }}
    namespace: {{ .Release.Namespace }}
    type: Opaque
  resyncSeconds: {{ .Values.doppler.resyncSeconds | default 60 }}
{{- end }}